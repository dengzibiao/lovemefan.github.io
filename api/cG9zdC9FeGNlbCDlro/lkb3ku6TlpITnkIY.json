{"title":"Excel 宏命令处理(一)","date":"2017-10-18T05:58:00.000Z","excerpt":"<p><strong> Excel 宏命令处理(一)：</strong> <excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"></excerpt></p>","slug":"Excel 宏命令处理","comments":true,"tags":["VBA","Excel","宏命令"],"updated":"2017-10-18T12:53:11.712Z","content":"<p><strong> Excel 宏命令处理(一)：</strong> <excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"></excerpt></p>\n<a id=\"more\"></a>\n<p><the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\"></the></p>\n<h1 id=\"Excel-宏命令处理\"><a href=\"#Excel-宏命令处理\" class=\"headerlink\" title=\"Excel 宏命令处理\"></a>Excel 宏命令处理</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;在我们工作的时候,常常会遇到大量的数据处理.人工操作费时费力,于是笔者开始百度看看有没有什么自动化的方法,最后发现了excel可以使用宏指令来实现编程式处理.</p>\n<h2 id=\"Excel-VBA\"><a href=\"#Excel-VBA\" class=\"headerlink\" title=\"Excel VBA\"></a>Excel VBA</h2><blockquote>\n<p> Visual Basic for Applications(VBA)是Visual Basic的一种宏语言，是微软开发出来在其桌面应用程序中执行通用的自动化(OLE)任务的编程语言。主要能用来扩展Windows的应用程式功能，特别是Microsoft Office软件。也可说是一种应用程式视觉化的Basic 脚本。该语言于1993年由微软公司开发的的应用程序共享一种通用的自动化语言——–Visual Basic For Application(VBA)，实际上VBA是寄生于VB应用程序的版本。微软在1994年发行的Excel5.0版本中，即具备了VBA的宏功能。<br>要熟悉VBA，那么就不得不先了解宏和它们之间的关系。<br>VBA被称为宏语言，但是它决不能和宏划上等号，宏是一条指令或者几条指令的集合，控制WORD或EXCEL等执行一连串的操作。而VBA则是不折不扣的高级语言，通过面向对象的方法来实现不能实现的功能。在编辑一个宏的时候，visual basic 编辑器会将这个宏记录为一个VBA过程<br>VBA使应用程序具有生命的特征，以适应不同的环境，不同的应用，其主要表现为定制、自动化、协作化。<br>VBA的特点是将VB语言与应用对象模型结合起来，处理各种应用需求。WORD VBA则是将VB应用于Word对象模型，或者说是用VB语言来操控这些Word对象模型，以达到各种应用的要求。所以，如果你想通过VBA控制WORD或EXCEL，必须同时熟悉VB语言和Word对象模型。</p>\n</blockquote>\n<h2 id=\"如何使用VBA\"><a href=\"#如何使用VBA\" class=\"headerlink\" title=\"如何使用VBA\"></a>如何使用VBA</h2><p><code>视图-宏</code><br><img src=\"http://oskhhyaq3.bkt.clouddn.com/blog/171018/hHHBK2h4eh.png?imageslim\" alt=\"VBA\"><br><img src=\"http://oskhhyaq3.bkt.clouddn.com/blog/171018/F7CBBaFhH3.png?imageslim\" alt=\"mark\"></p>\n<p>如果不能使用宏,可能你的excel禁用了.启动即可<br>启用方式:<br><code>文件-选项-信任中心-信任中心设置-宏设置-启用所有宏</code><br>配合录制宏就可以试着写代码了</p>\n<h2 id=\"Sheet-分割示例\"><a href=\"#Sheet-分割示例\" class=\"headerlink\" title=\"Sheet 分割示例\"></a>Sheet 分割示例</h2><figure class=\"highlight vbscript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">Sub</span> 自动分类()</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">' 前提条件:总表已经根据某个要分类的标识字段排好了顺序</span></div><div class=\"line\"><span class=\"comment\">' 此方法是将一张数据量非常大的sheet表按某个字段进行分类并分割成不同的sheet表</span></div><div class=\"line\"><span class=\"comment\">' 同时将该sheet的名称命名为sheet内标识该sheet的字段的名称</span></div><div class=\"line\">    <span class=\"keyword\">Dim</span> sheetPage As Integer</div><div class=\"line\">    <span class=\"keyword\">Dim</span> length As Integer <span class=\"comment\">'总表的最后一列的列数</span></div><div class=\"line\">    <span class=\"keyword\">Dim</span> i As Integer</div><div class=\"line\">    <span class=\"keyword\">Dim</span> Name As <span class=\"built_in\">String</span></div><div class=\"line\">    <span class=\"keyword\">Dim</span> topLeft As Integer <span class=\"comment\">'所选区域的左上角</span></div><div class=\"line\">    <span class=\"keyword\">Dim</span> bottomRight As Integer <span class=\"comment\">'所选区域的右下角</span></div><div class=\"line\">    </div><div class=\"line\"> <span class=\"comment\">'  参数初始化</span></div><div class=\"line\">    Name = <span class=\"string\">\"2013\"</span> <span class=\"comment\">'总表的名称</span></div><div class=\"line\">    length = <span class=\"number\">1510</span> <span class=\"comment\">'总表的最后一列的列数</span></div><div class=\"line\">    sheetPage = <span class=\"number\">4</span> <span class=\"comment\">'从第几张sheet开始生成</span></div><div class=\"line\">    topLeft = <span class=\"number\">2</span>   <span class=\"comment\">'初始从第几列开始</span></div><div class=\"line\">    bottomRight = <span class=\"number\">2</span> <span class=\"comment\">'初始从第几列结束</span></div><div class=\"line\"> <span class=\"comment\">'</span></div><div class=\"line\">    <span class=\"comment\">'先建表</span></div><div class=\"line\">        <span class=\"keyword\">For</span> i = <span class=\"number\">2</span> <span class=\"keyword\">To</span> length</div><div class=\"line\">            Sheets(Name).<span class=\"keyword\">Select</span></div><div class=\"line\">            bottomRight = i</div><div class=\"line\">            <span class=\"keyword\">If</span> Range(<span class=\"string\">\"A\"</span> &amp; topLeft).Value &lt;&gt; Range(<span class=\"string\">\"A\"</span> &amp; bottomRight).Value <span class=\"keyword\">Then</span></div><div class=\"line\">                Sheets.Add After:=ActiveSheet</div><div class=\"line\">                topLeft = bottomRight</div><div class=\"line\">            <span class=\"keyword\">End</span> <span class=\"keyword\">If</span></div><div class=\"line\">        <span class=\"keyword\">Next</span> i</div><div class=\"line\">    <span class=\"comment\">'割分</span></div><div class=\"line\">    </div><div class=\"line\">        topLeft = <span class=\"number\">2</span></div><div class=\"line\">        <span class=\"keyword\">For</span> i = <span class=\"number\">2</span> <span class=\"keyword\">To</span> length</div><div class=\"line\">           Sheets(Name).<span class=\"keyword\">Select</span></div><div class=\"line\">           </div><div class=\"line\">           bottomRight = i</div><div class=\"line\">           <span class=\"keyword\">If</span> Range(<span class=\"string\">\"A\"</span> &amp; topLeft).Value &lt;&gt; Range(<span class=\"string\">\"A\"</span> &amp; bottomRight).Value <span class=\"keyword\">Then</span></div><div class=\"line\">                Sheets(Name).<span class=\"keyword\">Select</span></div><div class=\"line\">                Range(<span class=\"string\">\"A\"</span> &amp; topLeft &amp; <span class=\"string\">\":\"</span> &amp; <span class=\"string\">\"G\"</span> &amp; (bottomRight - <span class=\"number\">1</span>)).<span class=\"keyword\">Select</span> <span class=\"comment\">'选择从AtopLeft到Gbottom的区域等待复制</span></div><div class=\"line\">                Selection.Copy</div><div class=\"line\">                </div><div class=\"line\">                Sheets(sheetPage).<span class=\"keyword\">Select</span></div><div class=\"line\">                Range(<span class=\"string\">\"A1\"</span>).<span class=\"keyword\">Select</span></div><div class=\"line\">                ActiveSheet.Paste</div><div class=\"line\">                Sheets(sheetPage).Name = Range(<span class=\"string\">\"A1\"</span>).Value</div><div class=\"line\">                sheetPage = sheetPage + <span class=\"number\">1</span></div><div class=\"line\">                topLeft = bottomRight</div><div class=\"line\">           <span class=\"keyword\">End</span> <span class=\"keyword\">If</span></div><div class=\"line\">            </div><div class=\"line\">        <span class=\"keyword\">Next</span> i</div><div class=\"line\">        </div><div class=\"line\">         Sheets(<span class=\"string\">\"2013\"</span>).<span class=\"keyword\">Select</span></div><div class=\"line\">         Range(<span class=\"string\">\"A\"</span> &amp; topLeft &amp; <span class=\"string\">\":\"</span> &amp; <span class=\"string\">\"G\"</span> &amp; (bottomRight - <span class=\"number\">1</span>)).<span class=\"keyword\">Select</span></div><div class=\"line\">         Selection.Copy</div><div class=\"line\">         </div><div class=\"line\">         Sheets(sheetPage - <span class=\"number\">1</span>).<span class=\"keyword\">Select</span></div><div class=\"line\">         Sheets.Add After:=ActiveSheet</div><div class=\"line\">         Sheets(sheetPage).<span class=\"keyword\">Select</span></div><div class=\"line\">         </div><div class=\"line\">         Range(<span class=\"string\">\"A1\"</span>).<span class=\"keyword\">Select</span></div><div class=\"line\">         ActiveSheet.Paste</div><div class=\"line\">         sheetName = Range(<span class=\"string\">\"A1\"</span>).Value</div><div class=\"line\">         Sheets(sheetPage).Name = sheetName</div><div class=\"line\">         </div><div class=\"line\">         topLeft = bottomRight</div><div class=\"line\">    </div><div class=\"line\">    </div><div class=\"line\">    </div><div class=\"line\"><span class=\"keyword\">End</span> <span class=\"keyword\">Sub</span></div><div class=\"line\"><span class=\"keyword\">Sub</span> 排序()</div><div class=\"line\">    <span class=\"keyword\">For</span> <span class=\"keyword\">Each</span> Sh <span class=\"keyword\">In</span> Worksheets</div><div class=\"line\">        <span class=\"keyword\">If</span> Sh.Index &gt; <span class=\"number\">4</span> <span class=\"keyword\">Then</span>  <span class=\"comment\">'限定工作表范围</span></div><div class=\"line\">            Sh.<span class=\"keyword\">Select</span></div><div class=\"line\">            Columns(<span class=\"string\">\"B:B\"</span>).<span class=\"keyword\">Select</span></div><div class=\"line\">            Sh.Sort.SortFields.Clear</div><div class=\"line\">            Sh.Sort.SortFields.Add Key:=Range(<span class=\"string\">\"B1\"</span>), _</div><div class=\"line\">                SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal</div><div class=\"line\">            <span class=\"keyword\">With</span> Sh.Sort</div><div class=\"line\">                .SetRange Range(<span class=\"string\">\"A1:G69\"</span>)</div><div class=\"line\">                .Header = xlNo</div><div class=\"line\">                .MatchCase = <span class=\"literal\">False</span></div><div class=\"line\">                .Orientation = xlTopToBottom</div><div class=\"line\">                .SortMethod = xlPinYin</div><div class=\"line\">                .Apply</div><div class=\"line\">            <span class=\"keyword\">End</span> <span class=\"keyword\">With</span></div><div class=\"line\">            <span class=\"keyword\">End</span> <span class=\"keyword\">If</span></div><div class=\"line\">        <span class=\"keyword\">Next</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">End</span> <span class=\"keyword\">Sub</span></div></pre></td></tr></table></figure>\n<h2 id=\"github源码下载\"><a href=\"#github源码下载\" class=\"headerlink\" title=\"github源码下载\"></a><a href=\"https://github.com/lovemefan/Excell-Macro\" target=\"_blank\" rel=\"external\">github源码下载</a></h2>","prev":{"title":"Android学习笔记 (二)   Intent唤醒其他Activity或APP","slug":"Android 如何唤醒第三方APP"},"next":{"title":"Java学习笔记 (一)   基于Robot类的一些自动测试类的一些应用","slug":"Java Robot类的一些应用"},"link":"/post/Excel 宏命令处理/index.html  2017/10/18","toc":[{"title":"Excel 宏命令处理","id":"Excel-宏命令处理","index":"1","children":[{"title":"Excel VBA","id":"Excel-VBA","index":"1.1"},{"title":"如何使用VBA","id":"如何使用VBA","index":"1.2"},{"title":"Sheet 分割示例","id":"Sheet-分割示例","index":"1.3"},{"title":"","id":"github源码下载","index":"1.4"}]}]}